<!doctype html>
<html lang="{{ .Lang }}" manifest="cache.manifest">
<head>
	<meta charset="utf-8"/>
	<meta name="description" content="Collection of simple Lua and Rust games that can be played in your browser. Includes solitaire, word games, chess, go, checkers. Supports local or websocket multiplayer."/>
	<meta name="keywords" content="games, simple, board games, lua, multiplayer, solitaire, chess, go, checkers"/>
	<meta name="author" content="Alex Barry"/>
	<!-- setting maximum-scale=1 to prevent auto zooming in on input fields in safari mobile.
	     this may be bad if it introduces other side effects.
	     I still want to allow zooming in on some board games (e.g. 19x19 go) -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="mobile-web-app-capable" content="yes" />
	<link rel="icon" type="image/png" href="img/logo.png" />
	<meta property="og:image" content="img/logo.png"/>
	<meta property="og:image:type" content="image/png">
	<meta property="og:image:width" content="512">
	<meta property="og:image:height" content="512">
	<link rel="apple-touch-icon" href="img/logo.png" />
	<link rel="apple-touch-startup-image" href="img/logo.png" />
	<meta rel="apple-mobile-web-app-title" content="AlexGames" />
	<title>{{ index .Site.Data.strings.default "title"  }}
	{{ if ne .Lang "en" }}
		({{ index .Site.Data.strings .Lang "translated_title"  }})
	{{ end }}
	</title>
    {{ partial "translations.html" . }}
	<script type="text/javascript" src="alexgames_wasm.js"></script>
	<script type="text/javascript" src="js/alexgames.js"></script>
	<script type="text/javascript" src="js/alexgames_colour_pref.js"></script>
	<script type="text/javascript" src="js/alexgames_ws.js"></script>
	<script type="text/javascript" src="js/alexgames_wasm_api.js"></script>
	<script type="text/javascript" src="js/alexgames_wasm_wrapper.js"></script>

	<!-- both of these aren't needed, only one is ever used at a time -->
	<script type="text/javascript" src="js/alexgames_dict.js"></script>
	<script type="text/javascript" src="js/alexgames_c_dict.js"></script>

	<script type="text/javascript" src="js/url_args.js"></script>
	<link rel="manifest" href="manifest.json">
	<link rel="stylesheet" type="text/css" href="css/style_very_dark.css">
	<link rel="stylesheet" type="text/css" href="css/style_dark.css">
	<link rel="stylesheet" type="text/css" href="css/style.css">

	<style>

	html, body {
		height: 97%;
	}

	.main {
		margin:5px auto;
		max-width:800px;
		padding: 10px;
		border-radius:15px;
		/* height: 100%; */
	}

	.title {
		margin:0;
		text-align:center;
	}

	.subtitle {
		margin: 0;
		text-align:center;
	}

	/* should be the same size as the options button, which inherits the size of all buttons */
	.logo {
		width:50px;
		height:50px;
		position:absolute;
	}

	.canvas_div {
		max-width:100%;
		flex:0;
		display:flex;
		flex-direction:column;
		align-self:center;
	}

	#game_canvas {
		max-width:100%;
		flex: 0 0 1;
		align-self:center;

		/* prevent double tapping to zoom in on iOS */
		touch-action: manipulation;
	}

	.button_row {
		width:100%;
		display:flex;
	}

	.canvas_div_wrapper {
		display:flex;
		flex-direction:column;
		position:relative;
	}

	.popup {
		position:absolute;
		left:0;
		top:0;
		right:0;
		/* bottom:0; */
		margin: auto;
		z-index:2;
	}

	.close_button {
		z-index:5;
		margin:10px;
	}

	.game_popup {
		padding: 20px;
		overflow:auto;
		width: 300px;
		height:420px;

	}

	/*
	 * Meant for popups like "options" and "game_choice", but not
	 * popups generated by games.
	 * This one is almost full screen, the others are not. 
	 */
	.meta_popup {
		box-sizing: border-box;
		position:fixed;
		margin: auto;
		max-width:700px;
		top: 65px;
		bottom: 20px;
		z-index: 4;
	}

	.options_popup {
		overflow-y: scroll;
		z-index: 5;
	}

	.game_choice_popup_wrapper {
		position:absolute;
		top: 0;
		bottom: 0;
		padding-top: 20px;
		padding-bottom: 20px;
		overflow-y:scroll;
	}

	.game_popup > button {
		width:100%;
		margin-top:10px;
	}

	button.game_btn {
		margin: 5px;
	}

	button {
		height:50px;

		/* prevent double tapping a button to zoom in on iOS */
		touch-action: manipulation;
	}


	.overlay {
		position:absolute;
		left:0;
		top:0;
		right:0;
		bottom:0;
		z-index:1;
	}

	.overlay_transparent {
		position:absolute;
		left:0;
		top:0;
		right:0;
		bottom:0;
	}

	.unset_game_instructions_cls {
		display: flex;
		align-items: center;
		justify-content: center;
	}

	.fullscreen_msg {
		max-width: 480px;
		text-align: center;
	}
	.fullscreen_err_msg > p {
		color:red;
	}

	</style>
</head>
<body>

<div class="main" style="position:relative">

<div id="header" class="header" style="position:relative">
<div style="display:block; margin:auto">
<a href="index.html"><img class="logo" src="img/logo-transparent.png" alt="AlexGames logo"/></a>
<h1 id="title" class="title" style=""><a class="no_underline" href="index.html">
{{ index .Site.Data.strings.default "title"  }}
{{ if ne .Lang "en" }}
		({{ index .Site.Data.strings .Lang "translated_title"  }})
{{ end }}
</a></h1>
<h2 id="subtitle" class="subtitle">{{ index .Site.Data.strings .Lang "choose_a_game" }}</h2>
</div>
<button id="btn_options" style="position:absolute; top:0; right:0">{{ index .Site.Data.strings .Lang "options" }}</button>
</div>


<div class="canvas_div_wrapper">
<!-- TODO Make this shrink to fit in entire screen, up to
     some max on desktop only -->
<div class="canvas_div">
<div style="display:flex">
<div id="status" class="status" style="flex:1">Initializing...</div>
<!--<span id="status_err" class="status status_error">&nbsp;</span>-->
<!-- This button is only shown if the header is hidden -->
<button id="btn_status_options" style="flex:0; display:none">{{ index .Site.Data.strings .Lang "options" }}</button>
</div>
<div id="fullscreen_msg_wrapper" class="unset_game_instructions_cls overlay_transparent" style="display:none">
<div id="fullscreen_err_msg" class="fullscreen_msg fullscreen_err_msg">
</div>
</div>
<div id="unset_game_instructions" class="unset_game_instructions_cls overlay_transparent">
<div class="fullscreen_msg">
<!-- TODO show "loading, please wait" at first. Then change it to this once the game is loaded -->
<p>
{{ index .Site.Data.strings .Lang "press_here_to_select_a_game" }}
</p>
<p>
{{ index .Site.Data.strings .Lang "press_here_to_select_a_game_alternative" }}
</p>
</div>
</div>
<canvas id="game_canvas" width="480" height="480">
{{ index .Site.Data.strings .Lang "canvas_not_supported_err_msg" }}
</canvas>



<div id="game_button_row" class="button_row">
<!-- Buttons are added here from the game API -->
</div>

<div id="popup" class="popup game_popup" style="display:none">
<!-- This popup is populated and set visible by the game API -->
</div>

<div class="overlay" style="display:none"></div>
</div>

</div>


<!-- This is made visible when the user presses the "Options" button -->
<div id="options_popup" class="popup meta_popup options_popup" style="display:none">
<button id="btn_close_options" class="close_button">X</button>
<div class="popup_content_wrapper">
<h2 class="title">{{ index .Site.Data.strings .Lang "options" }}</h2>
<h3>{{ index .Site.Data.strings .Lang "main" }}</h3>

<button id="btn_game_select" class="options_button">{{ index .Site.Data.strings .Lang "select_different_game" }}</button>
<button id="btn_history_browse" class="options_button">{{ index .Site.Data.strings .Lang "load_autosaved_game" }}</button>

<div style="display:flex; flex-direction:row">
<div style="flex:1; display:flex; align-items: center; margin-right:5px">
<label for="select_user_colour_pref" style="flex:0">{{ index .Site.Data.strings .Lang "colour_scheme" }}</label>
<select id="select_user_colour_pref" class="popup_dropdown" style="flex:1">
<option value="auto">{{ index .Site.Data.strings .Lang "colour_scheme_auto" }}</option>
<option value="light">{{ index .Site.Data.strings .Lang "colour_scheme_light" }}</option>
<option value="dark">{{ index .Site.Data.strings .Lang "colour_scheme_dark" }}</option>
<option value="very_dark">{{ index .Site.Data.strings .Lang "colour_scheme_very_dark" }}</option>
</select>
</div>
<div style="flex:1">
<p class="small">{{ index .Site.Data.strings .Lang "colour_scheme_update_refresh_needed" }}<span class="small">{{ index .Site.Data.strings .Lang "could_be_fixed_in_future_update" }}</span></p>
</div>
</div>

<h3>{{ index .Site.Data.strings .Lang "game_options" }}</h3>
<!-- These options are populated by the game API -->
<div id="game_options">
<div id="game_options_none_placeholder">
<p>{{ index .Site.Data.strings .Lang "game_options_not_defined" | safeHTML }}</p>
</div>
<!-- for example: -->
<!--<button class="options_button">Start new game</button>-->
</div>

<h3>{{ index .Site.Data.strings .Lang "share_export_state" }}</h3>
<h4 class="options_subheading">{{ index .Site.Data.strings .Lang "current_state" }}</h4>
<div id="current_state_not_supported" style="display:none">
<p class="not_supported">{{ index .Site.Data.strings .Lang "url_share_state_not_supported" | safeHTML }}</p>
</div>

<div id="current_state_supported">
<p class="options_p">{{ index .Site.Data.strings .Lang "url_share_current_state_supported" | safeHTML }}</p>
<div class="url_container">
<a id="url_current_state" class="url_span" href="#"></a>
</div>
</div>

<h4 class="options_subheading">{{ index .Site.Data.strings .Lang "initial_state" }}</h4>
<div id="init_state_not_supported" style="display:none">
<p class="not_supported">{{ index .Site.Data.strings .Lang "url_share_init_state_not_supported" | safeHTML }}</p>
</div>

<div id="init_state_eq_state" style="display:none">
<p class="not_supported">{{ index .Site.Data.strings .Lang "init_state_eq_current_state" | safeHTML }}</p>
</div>


<div id="init_state_supported">
<p class="options_p">{{ index .Site.Data.strings .Lang "url_init_state_description" }}</p>
<div class="url_container">
<a id="url_init_state" class="url_span" href="#"></a>
</div>
</div>


<h3>{{ index .Site.Data.strings .Lang "upload_game_bundle" }}</h3>
{{ index .Site.Data.strings .Lang "upload_game_bundle" | safeHTML }}
<input type="file" id="input_upload_game_bundle" style="popup_input_row"/>
<button id="btn_process_uploaded_game_bundle" disabled>{{ index .Site.Data.strings .Lang "process_game_bundle" }}</button>

<h3>{{ index .Site.Data.strings .Lang "multiplayer_settings" }}</h3>
<p>{{ index .Site.Data.strings .Lang "multiplayer_url_description" }}</p>
<div class="url_container">
<a id="url_share_multiplayer" class="url_span" href="#"></a>
</div>
<p>{{ index .Site.Data.strings .Lang "multiplayer_id_description" }}</p>
<div class="popup_table">

<div class="popup_row">
<label for="session_id_input" class="label_col">{{ index .Site.Data.strings .Lang "session_id_label" }}</label>
<input id="session_id_input" class="input_col"></input>
</div>


<div class="popup_row">
<label for="custom_ws_server_input" class="label_col">{{ index .Site.Data.strings .Lang "websocket_server_label" }}</label>
<input id="custom_ws_server_input" class="input_col" placeholder="{{ index .Site.Data.strings .Lang "example_label" }}: wss://alexbarry.net:55433, {{ index .Site.Data.strings .Lang "or" }} ws://192.168.1.100:5678"></input>
</div>

</div>

<button id="btn_submit_multiplayer_settings" style="width: 100%">{{ index .Site.Data.strings .Lang "submit_multiplayer_settings" }}</button>

<h3>{{ index .Site.Data.strings .Lang "miscellaneous" }}</h3>
<button id="btn_force_refresh" class="options_button">{{ index .Site.Data.strings .Lang "force_refresh" }}</button>
<!--
<label for="theme_select">Theme</label>
<select id="theme_select">
<option>Auto</option>
<option>Light</option>
<option>Dark</option>
</select>
<h3>Multiplayer</h3>
<label for="custom_ws_server">Custom Websocket server</label>
<input id="custom_ws_server" placeholder="e.g. wss://alexgames.example.com:55040"></input>

TODO add session ID to options, maybe show other players that are connected
-->

<p></p>
<a id="about_link_options" href="#">{{ index .Site.Data.strings .Lang "alexgames_created_by_click_for_about" }}</a>
</div>
</div>


<div id="game_choice_popup" class="popup game_choice_popup meta_popup" style="display:none">
<button id="btn_close_game_choice_popup" class="close_button">X</button>
<div class="game_choice_popup_wrapper">
<h2 class="title">{{ index .Site.Data.strings .Lang "choose_a_game" }}</h2>

<div id="game_row_solitaire" class="game_row">
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/solitaire.png"/></div>
<h2 class="game_title">{{ index .Site.Data.strings .Lang "solitaire" }}</h2>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "single_player" }}</p>
<p>{{ index .Site.Data.strings .Lang "solitaire_description" }}</p>
</div>
</div>

<div id="game_row_word_mastermind" class="game_row">
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/word_mastermind.png"/></div>
<h2 class="game_title">{{ index .Site.Data.strings .Lang "word_mastermind" }}</h2>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "single_player" }}</p>
<p>{{ index .Site.Data.strings .Lang "word_mastermind_description1" }}</p>
<p>{{ index .Site.Data.strings .Lang "word_mastermind_description2" }}</p>
</div>
</div>

<div id="game_row_chess" class="game_row">
<h2 class="game_title">{{ index .Site.Data.strings .Lang "chess" }}</h2>
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/chess.png"/></div>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "network_or_local_multiplayer" }}{{ index .Site.Data.strings .Lang "colon" }} {{ index .Site.Data.strings .Lang "two_players" }}</p>
<p>{{ index .Site.Data.strings .Lang "chess_description" }}</p>
</div>
</div>


<div id="game_row_crossword_letters" class="game_row">
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/crossword_letters.png"/></div>
<h2 class="game_title">{{ index .Site.Data.strings .Lang "crossword_letters" }}</h2>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "single_player" }}</p>
<p>{{ index .Site.Data.strings .Lang "crossword_letters_description" }}</p>
</div>
</div>

<div id="game_row_gem_match" class="game_row">
<h2 class="game_title">{{ index .Site.Data.strings .Lang "gem_match" }}</h2>
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/gem_match.png"/></div>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "single_player" }}</p>
<p>{{ index .Site.Data.strings .Lang "gem_match_description" }}</p>
</div>
</div>


<div id="game_row_go" class="game_row">
<h2 class="game_title">{{ index .Site.Data.strings .Lang "go_title" }}</h2>
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/go.png"/></div>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "network_or_local_multiplayer" }}{{ index .Site.Data.strings .Lang "colon" }} {{ index .Site.Data.strings .Lang "two_players" }}</p>
<p>{{ index .Site.Data.strings .Lang "go_description" }}</p>
<p><strong>{{ index .Site.Data.strings .Lang "note_prefix" }}</strong> {{ index .Site.Data.strings .Lang "go_no_ai_disclaimer" }}</p>
</div>
</div>

<div id="game_row_reversi" class="game_row">
<h2 class="game_title">{{ index .Site.Data.strings .Lang "reversi" }}</h2>
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/reversi.png"/></div>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "local_multiplayer" }}</p>
<p>{{ index .Site.Data.strings .Lang "reversi_description" }}</p>
</div>
</div>

<div id="game_row_checkers" class="game_row">
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/checkers.png"/></div>
<h2 class="game_title">{{ index .Site.Data.strings .Lang "checkers" }}</h2>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "network_or_local_multiplayer" }}{{ index .Site.Data.strings .Lang "colon" }} {{ index .Site.Data.strings .Lang "two_players" }}</p>
<p>{{ index .Site.Data.strings .Lang "checkers_description" }}</p>
</div>
</div>

<div id="game_row_endless_runner" class="game_row">
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/endless_runner.png"/></div>
<h2 class="game_title">{{ index .Site.Data.strings .Lang "endless_runner" }}</h2>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "single_player" }}</p>
<p>{{ index .Site.Data.strings .Lang "endless_runner_description" }}</p>
</div>
</div>

<div id="game_row_minesweeper" class="game_row">
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/minesweeper.png"/></div>
<h2 class="game_title">{{ index .Site.Data.strings .Lang "minesweeper" }}</h2>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "single_or_network_multiplayer_up_to_4_players" }}</p>
<p>{{ index .Site.Data.strings .Lang "minesweeper_description" }}</p>
</div>
</div>

<div id="game_row_fluid_mix" class="game_row">
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/fluid_mix.png"/></div>
<h2 class="game_title">{{ index .Site.Data.strings .Lang "fluid_mix" }}</h2>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "single_player" }}</p>
<p>{{ index .Site.Data.strings .Lang "fluid_mix_description" }}</p>
</div>
</div>

<div id="game_row_backgammon" class="game_row">
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/backgammon.png"/></div>
<h2 class="game_title">{{ index .Site.Data.strings .Lang "backgammon" }}</h2>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "network_or_local_multiplayer" }}{{ index .Site.Data.strings .Lang "colon" }} {{ index .Site.Data.strings .Lang "two_players" }}</p>
<p>{{ index .Site.Data.strings .Lang "backgammon_description" }}</p>
</div>
</div>

<div id="game_row_crib" class="game_row">
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/crib.png"/></div>
<h2 class="game_title">{{ index .Site.Data.strings .Lang "crib" }}</h2>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "network_multiplayer_two_to_four_players" }}</p>
<p>{{ index .Site.Data.strings .Lang "crib_description" }}</p>
</div>
</div>

<div id="game_row_spider_swing" class="game_row">
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/spider_swing.png"/></div>
<h2 class="game_title">{{ index .Site.Data.strings .Lang "spider_swing" }}</h2>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "single_player" }}</p>
<p>{{ index .Site.Data.strings .Lang "spider_swing_description" }}</p>
</div>
</div>

<div id="game_row_thrust" class="game_row">
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/thrust.png"/></div>
<h2 class="game_title">{{ index .Site.Data.strings .Lang "thrust" }}</h2>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "single_player" }}</p>
<p>{{ index .Site.Data.strings .Lang "thrust_description" }}</p>
</div>
</div>

<div id="game_row_wu" class="game_row">
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/wu.png"/></div>
<h2 class="game_title">{{ index .Site.Data.strings .Lang "wu" }}</h2>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "network_or_local_multiplayer" }}{{ index .Site.Data.strings .Lang "colon" }} {{ index .Site.Data.strings .Lang "two_players" }}</p>
<p>{{ index .Site.Data.strings .Lang "wu_description" }}</p>
</div>
</div>



<div id="game_row_31s" class="game_row">
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/31s.png"/></div>
<h2 class="game_title">{{ index .Site.Data.strings .Lang "game_31s" }}</h2>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "network_multiplayer_two_to_four_players" }}</p>
<p>{{ index .Site.Data.strings .Lang "game_31s_description" }}</p>
</div>
</div>

<div id="game_row_hospital" class="game_row">
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/hospital.png"/></div>
<h2 class="game_title">{{ index .Site.Data.strings .Lang "hospital" }}</h2>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "single_or_network_multiplayer_up_to_4_players" }}</p>
<p>{{ index .Site.Data.strings .Lang "hospital_description" }}</p>
</div>
</div>

<div id="game_row_life" class="game_row">
<div class="game_wrapper"><img class="game_icon" src="img/game_icons/life.png"/></div>
<h2 class="game_title">{{ index .Site.Data.strings .Lang "conway_life" }}</h2>
<div class="description">
<p>{{ index .Site.Data.strings .Lang "single_player_zero_player" }}</p>
<p>{{ index .Site.Data.strings .Lang "conway_life_description" | safeHTML }}</p>
</div>
</div>

<div class="game_list_padding"></div>

</div>

</div>

<script>
let game_choice_row_infos = [
	{ row_id: "game_row_chess",        game_id: "chess" },
	{ row_id: "game_row_go",           game_id: "go" },
	{ row_id: "game_row_checkers",     game_id: "checkers" },
	{ row_id: "game_row_solitaire",    game_id: "solitaire" },
	{ row_id: "game_row_gem_match",    game_id: "gem_match" },
	{ row_id: "game_row_reversi",      game_id: "reversi" },
	{ row_id: "game_row_minesweeper",  game_id: "minesweeper" },
	{ row_id: "game_row_endless_runner",  game_id: "endless_runner" },
	{ row_id: "game_row_fluid_mix",    game_id: "fluid_mix" },
	{ row_id: "game_row_wu",           game_id: "wu" },
	{ row_id: "game_row_backgammon",   game_id: "backgammon" },
	{ row_id: "game_row_word_mastermind", game_id: "word_mastermind" },
	{ row_id: "game_row_crossword_letters", game_id: "crossword_letters" },
	{ row_id: "game_row_crib",         game_id: "crib" },
	{ row_id: "game_row_thrust",       game_id: "thrust" },
	{ row_id: "game_row_31s",          game_id: "31s" },
	{ row_id: "game_row_life",         game_id: "life" },
	{ row_id: "game_row_spider_swing", game_id: "spider_swing" },
	{ row_id: "game_row_hospital",     game_id: "hospital" },
];
for (let game_choice_row_info of game_choice_row_infos) {
	document.getElementById(game_choice_row_info.row_id).addEventListener('click', function() {
		console.log("[init] User selected game via button press:", game_choice_row_info.game_id);
		game_chosen(game_choice_row_info.game_id);
	});
}
</script>

</div>

<div id="about_popup" class="popup meta_popup options_popup" style="display:none">
<button id="btn_close_about_popup" class="close_button">X</button>
<div class="popup_content_wrapper">
<h2 class="title">{{ index .Site.Data.strings .Lang "about_alexgames" }}</h2>

<p>{{ index .Site.Data.strings .Lang "about_alexgames_line1" }}</p>
<p>
{{ index .Site.Data.strings .Lang "about_alexgames_line2_pt1" }} 
<a href="example_game_apidemo.zip">{{ index .Site.Data.strings .Lang "the_example_lua_game_zip" }}</a>
{{ index .Site.Data.strings .Lang "consult_the" }} 
<a href="game_api_doc.html" target="_blank">{{ index .Site.Data.strings .Lang "lua_api_reference" }}</a>
{{ index .Site.Data.strings .Lang "about_alexgames_line2_pt2" }}
</p>

<p>{{ index .Site.Data.strings .Lang "about_alexgames_line3" }}</p>

<p>{{ index .Site.Data.strings .Lang "about_alexgames_line4" }}</p>

<p>{{ index .Site.Data.strings .Lang "created_by" }} <a href="https://github.com/alexbarry">Alex Barry</a>. {{ index .Site.Data.strings .Lang "encouraged_to_say_hi_at" }}</p>

<ul>
	<li>Github: <a class="url" href="https://github.com/alexbarry/AlexGames" target="_blank">github.com/alexbarry/AlexGames</a></li>
	<li>Discord: <a class="url" href="https://discord.gg/rhy8SuHPYU" target="_blank">discord.gg/rhy8SuHPYU</a></li>
	<li>Lemmy: <a class="url" href="https://lemmyverse.link/c/alexgames@lemmy.ca" target="_blank">!alexgames@lemmy.ca</a></li>
	<li>Matrix: <a class="url" href="https://matrix.to/#/#alexgames:matrix.org" target="_blank">#alexgames:matrix.org</a></li>
	<li>{{ index .Site.Data.strings .Lang "email" }}: <span class="url">alexbarry.dev2 [ at ] gmail.com</span></li>
</ul>

<p>{{ index .Site.Data.strings .Lang "also_available_as_an" }} <a href="https://f-droid.org/packages/net.alexbarry.alexgames" target="_blank">{{ index .Site.Data.strings .Lang "android_app_on_fdroid" }}</a> {{ index .Site.Data.strings .Lang "for_offline_play" }}</p>

<p>{{ index .Site.Data.strings .Lang "project_would_not_be_possible_without_other_projects" }}</p>
<ul>
<li><a href="https://lua.org"><img alt="Lua Logo" src="img/credits/Lua-Logo_128x128.png" width="48" height="48"/></a> {{ index .Site.Data.strings .Lang "lua_lang_description" }}</li>
<li><a href="https://cmake.org">CMake</a>: {{ index .Site.Data.strings .Lang "cmake_description" }}</li>
<li><a href="https://emscripten.org">Emscripten</a>: {{ index .Site.Data.strings .Lang "emscripten_description" }}</li>
<li><a href="https://www.rust-lang.org/">Rust (Language)</a>: {{ index .Site.Data.strings .Lang "rust_lang_description" }}</li>
</ul>
<!-- The others don't explicitly say to include their logo, so I'm not sure if I should. -->
<p>{{ index .Site.Data.strings .Lang "see_more_in_the" }} <a href="licenses.html" target="_blank">{{ index .Site.Data.strings .Lang "licenses_page" }}</a>{{ index .Site.Data.strings .Lang "end_of_sentence" }}</p>

</div>
</div>

<!-- preload images -->
<div style="display:none">
<img id ="board" src="img/wooden_board.png"/>
<img id ="piece_black" src="img/black_piece.png"/>
<img id ="piece_white" src="img/white_piece.png"/>
<img id ="piece_highlight" src="img/piece_highlight.png"/>

<img id ="piece_king_icon" src="img/piece_king_icon.png"/>

<img id ="card_diamonds" src="img/cards/diamonds.png"/>
<img id ="card_hearts"   src="img/cards/hearts.png"/>
<img id ="card_spades"   src="img/cards/spades.png"/>
<img id ="card_clubs"    src="img/cards/clubs.png"/>
<img id ="card_blank"    src="img/cards/blank_card.png"/>
<img id ="card_facedown" src="img/cards/card_facedown.png"/>
<img id ="card_highlight" src="img/cards/card_highlight.png"/>

<img id ="more_info_btn" src="img/more_info_btn.png"/>

<img id ="backgammon_triangle_black" src="img/backgammon/triangle_black.png"/>
<img id ="backgammon_triangle_white" src="img/backgammon/triangle_white.png"/>
<img id ="backgammon_triangle_highlight" src="img/backgammon/triangle_highlight.png"/>

<img id="chess_rook_white"   src="img/chess/rook_white.png"/>
<img id="chess_knight_white" src="img/chess/knight_white.png"/>
<img id="chess_bishop_white" src="img/chess/bishop_white.png"/>
<img id="chess_pawn_white"   src="img/chess/pawn_white.png"/>
<img id="chess_queen_white"  src="img/chess/queen_white.png"/>
<img id="chess_king_white"   src="img/chess/king_white.png"/>

<img id="chess_rook_black"   src="img/chess/rook_black.png"/>
<img id="chess_knight_black" src="img/chess/knight_black.png"/>
<img id="chess_bishop_black" src="img/chess/bishop_black.png"/>
<img id="chess_pawn_black"   src="img/chess/pawn_black.png"/>
<img id="chess_queen_black"  src="img/chess/queen_black.png"/>
<img id="chess_king_black"   src="img/chess/king_black.png"/>

<img id="chess_rook_black_dark"   src="img/chess/rook_black_dark.png"/>
<img id="chess_knight_black_dark" src="img/chess/knight_black_dark.png"/>
<img id="chess_bishop_black_dark" src="img/chess/bishop_black_dark.png"/>
<img id="chess_pawn_black_dark"   src="img/chess/pawn_black_dark.png"/>
<img id="chess_queen_black_dark"  src="img/chess/queen_black_dark.png"/>
<img id="chess_king_black_dark"   src="img/chess/king_black_dark.png"/>


<img id ="dice1" src="img/dice/dice1.png"/>
<img id ="dice2" src="img/dice/dice2.png"/>
<img id ="dice3" src="img/dice/dice3.png"/>
<img id ="dice4" src="img/dice/dice4.png"/>
<img id ="dice5" src="img/dice/dice5.png"/>
<img id ="dice6" src="img/dice/dice6.png"/>


<img id ="arrow" src="img/arrow.png"/>

<img id ="minesweeper_mine" src="img/minesweeper/mine.png"/>
<img id ="minesweeper_box1" src="img/minesweeper/box1.png"/>
<img id ="minesweeper_box2" src="img/minesweeper/box2.png"/>
<img id ="minesweeper_box3" src="img/minesweeper/box3.png"/>
<img id ="minesweeper_box4" src="img/minesweeper/box4.png"/>
<img id ="minesweeper_box5" src="img/minesweeper/box5.png"/>
<img id ="minesweeper_box6" src="img/minesweeper/box6.png"/>
<img id ="minesweeper_box7" src="img/minesweeper/box7.png"/>
<img id ="minesweeper_box8" src="img/minesweeper/box8.png"/>
<img id ="minesweeper_box_unclicked"    src="img/minesweeper/box_unclicked.png"/>
<img id ="minesweeper_box_empty"        src="img/minesweeper/box_empty.png"/>
<img id ="minesweeper_box_flagged_red"  src="img/minesweeper/box_flagged_red.png"/>
<img id ="minesweeper_box_flagged_blue" src="img/minesweeper/box_flagged_blue.png"/>

<img id ="hospital_floor_tile" src="img/hospital/floor_tile.png"/>
<img id ="hospital_floor_tile_bad" src="img/hospital/floor_tile_bad.png"/>
<img id ="hospital_doctor1"    src="img/hospital/doctor1.png"/>
<img id ="hospital_doctor2"    src="img/hospital/doctor2.png"/>
<img id ="hospital_doctor3"    src="img/hospital/doctor3.png"/>
<img id ="hospital_doctor4"    src="img/hospital/doctor4.png"/>
<img id ="hospital_patient_in_bed"    src="img/hospital/patient_in_bed.png"/>
<img id ="hospital_patient_in_bed_flipped"    src="img/hospital/patient_in_bed-flipped.png"/>
<img id ="hospital_ui_dirpad"  src="img/hospital/ui/dirpad.png"/>
<img id ="hospital_ui_thumb_buttons"  src="img/hospital/ui/thumb_buttons.png"/>
<img id ="hospital_bed"        src="img/hospital/bed1.png"/>
<img id ="hospital_bed_flipped"src="img/hospital/bed1-flipped.png"/>
<img id ="hospital_iv_bag"     src="img/hospital/iv_stand_bag1.png"/>
<img id ="hospital_defib"      src="img/hospital/defibrillator_sabrina.png"/>
<img id ="hospital_ventilator" src="img/hospital/ventilator.png"/>
<img id ="hospital_xray_sheet" src="img/hospital/xray_sheet.png"/>
<img id ="hospital_xray_source" src="img/hospital/xray_source.png"/>
<img id ="hospital_ui_patient_needs_bg" src="img/hospital/patient_need_icons/bg.png"/>
<img id ="hospital_ui_patient_needs_bg_fixer" src="img/hospital/patient_need_icons/bg_fixer.png"/>
<img id ="hospital_ui_patient_needs_attention" src="img/hospital/patient_need_icons/attention.png"/>
<img id ="hospital_ui_patient_needs_low_fluids" src="img/hospital/patient_need_icons/low_fluids.png"/>
<img id ="hospital_ui_patient_needs_low_oxygen" src="img/hospital/patient_need_icons/low_oxygen.png"/>
<img id ="hospital_ui_patient_needs_no_heartbeat" src="img/hospital/patient_need_icons/no_heartbeat.png"/>
<img id ="hospital_ui_patient_needs_broken_bone" src="img/hospital/patient_need_icons/broken_bone.png"/>
<img id ="hospital_ui_green_cross" src="img/hospital/green_cross_icon.png"/>

<img id ="space_ship1"  src="img/space/ship1.png"/>
<img id ="lunar_lander" src="img/space/lunar_lander.png"/>
<img id ="swarm_grass_bg1" src="img/swarm/grass_bg1.png"/>
<img id ="swarm_broccoli"  src="img/swarm/broccoli.png"/>
<img id ="swarm_hammer"    src="img/swarm/hammer.png"/>

<img id ="brick_wall" src="img/brick_wall.png"/>
<img id ="spider"     src="img/spider.png"/>
</div>

<div class="footer_links">
<ul class="footer_links_list">
	<li><a id="about_link_footer" href="#">{{ index .Site.Data.strings .Lang "about" }}</a></li>
	<li><a href="licenses.html" target="_blank">{{ index .Site.Data.strings .Lang "licenses" }}</a></li>
	<li><a href="https://github.com/alexbarry/AlexGames" target="_blank">{{ index .Site.Data.strings .Lang "source" }}</a></li>
</div>

<script>

	// TODO make this a better abstraction to allow for overriding the messaging API
	// to use something other than websockets
	const send_message = ws_send_message;

	set_unset_game_instructions_visible(false);
	const status_msg = document.getElementById("status");

	if (typeof WebAssembly === 'undefined') {
		let msg = translations.wasm_disabled;
		console.error(msg);
		let gfx = {
			"status_msg": status_msg,
		};
		set_status_err(gfx, msg);
		set_fullscreen_err(msg);
	} else {
		console.debug("WebAssembly variable is defined");
	}

	let wasm_init = false;
	let ws_init   = false;
	let ws_error  = false;
	let ws_error_msg = null;
	let html_init = false;
	let dict_needed = false;
	let dict_is_init = false; // TODO

	// If this is set, then don't even try to connect to a websocket (e.g. don't show error messages).
	// This is intended for the case where the web version is bundled inside another application
	// for offline-only use.
	let no_ws = (URL_args && URL_args.no_ws && URL_args.no_ws.toLowerCase() == "true");

	let game_ready_without_network = () => { return wasm_init && html_init && ( !dict_needed || dict_is_init); };
	let network_ready = () => { return (ws_init || ws_error); };
	let allReady = () => { return game_ready_without_network() && (no_ws || network_ready()); };


	// doing it this way might be too late, we could miss the event
	//Module['onRuntimeInitialized'] = function() {
	var Module = null;
	createMyModule().then(MyModule => {
		// TODO rename this to something unique
		Module = MyModule;
		wasm_init = true;
		console.log("[init] wasm init");
		partial_init();
	});

	let canvas         = document.getElementById("game_canvas");

	let graphics_map = new Map();
	graphics_map.set("board",       document.getElementById("board"));
	graphics_map.set("piece_black", document.getElementById("piece_black"));
	graphics_map.set("piece_white", document.getElementById("piece_white"));
	graphics_map.set("piece_highlight", document.getElementById("piece_highlight"));
	graphics_map.set("piece_king_icon", document.getElementById("piece_king_icon"));
	graphics_map.set("card_blank"    , document.getElementById("card_blank"));
	graphics_map.set("card_facedown" , document.getElementById("card_facedown"));
	graphics_map.set("card_highlight", document.getElementById("card_highlight"));
	graphics_map.set("card_diamonds" , document.getElementById("card_diamonds"));
	graphics_map.set("card_hearts"   , document.getElementById("card_hearts"  ));
	graphics_map.set("card_spades"   , document.getElementById("card_spades"  ));
	graphics_map.set("card_clubs"    , document.getElementById("card_clubs"   ));
	graphics_map.set("more_info_btn" , document.getElementById("more_info_btn"));
	graphics_map.set("backgammon_triangle_black" , document.getElementById("backgammon_triangle_black"));
	graphics_map.set("backgammon_triangle_white" , document.getElementById("backgammon_triangle_white"));
	graphics_map.set("backgammon_triangle_highlight" , document.getElementById("backgammon_triangle_highlight"));

	graphics_map.set("chess_rook_white",   document.getElementById("chess_rook_white"));
	graphics_map.set("chess_knight_white", document.getElementById("chess_knight_white"));
	graphics_map.set("chess_bishop_white", document.getElementById("chess_bishop_white"));
	graphics_map.set("chess_pawn_white",   document.getElementById("chess_pawn_white"));
	graphics_map.set("chess_queen_white",  document.getElementById("chess_queen_white"));
	graphics_map.set("chess_king_white",   document.getElementById("chess_king_white"));

	graphics_map.set("chess_rook_black_dark",   document.getElementById("chess_rook_black_dark"));
	graphics_map.set("chess_knight_black_dark", document.getElementById("chess_knight_black_dark"));
	graphics_map.set("chess_bishop_black_dark", document.getElementById("chess_bishop_black_dark"));
	graphics_map.set("chess_pawn_black_dark",   document.getElementById("chess_pawn_black_dark"));
	graphics_map.set("chess_queen_black_dark",  document.getElementById("chess_queen_black_dark"));
	graphics_map.set("chess_king_black_dark",   document.getElementById("chess_king_black_dark"));

	graphics_map.set("chess_rook_black",   document.getElementById("chess_rook_black"));
	graphics_map.set("chess_knight_black", document.getElementById("chess_knight_black"));
	graphics_map.set("chess_bishop_black", document.getElementById("chess_bishop_black"));
	graphics_map.set("chess_pawn_black",   document.getElementById("chess_pawn_black"));
	graphics_map.set("chess_queen_black",  document.getElementById("chess_queen_black"));
	graphics_map.set("chess_king_black",   document.getElementById("chess_king_black"));

	graphics_map.set("dice1" , document.getElementById("dice1"));
	graphics_map.set("dice2" , document.getElementById("dice2"));
	graphics_map.set("dice3" , document.getElementById("dice3"));
	graphics_map.set("dice4" , document.getElementById("dice4"));
	graphics_map.set("dice5" , document.getElementById("dice5"));
	graphics_map.set("dice6" , document.getElementById("dice6"));
	graphics_map.set("arrow" , document.getElementById("arrow"));
	graphics_map.set("minesweeper_mine" , document.getElementById("minesweeper_mine" ));
	graphics_map.set("minesweeper_box1" , document.getElementById("minesweeper_box1" ));
	graphics_map.set("minesweeper_box2" , document.getElementById("minesweeper_box2" ));
	graphics_map.set("minesweeper_box3" , document.getElementById("minesweeper_box3" ));
	graphics_map.set("minesweeper_box4" , document.getElementById("minesweeper_box4" ));
	graphics_map.set("minesweeper_box5" , document.getElementById("minesweeper_box5" ));
	graphics_map.set("minesweeper_box6" , document.getElementById("minesweeper_box6" ));
	graphics_map.set("minesweeper_box7" , document.getElementById("minesweeper_box7" ));
	graphics_map.set("minesweeper_box8" , document.getElementById("minesweeper_box8" ));
	graphics_map.set("minesweeper_box_unclicked"    , document.getElementById("minesweeper_box_unclicked"    ));
	graphics_map.set("minesweeper_box_empty"        , document.getElementById("minesweeper_box_empty"        ));
	graphics_map.set("minesweeper_box_flagged_red"  , document.getElementById("minesweeper_box_flagged_red"  ));
	graphics_map.set("minesweeper_box_flagged_blue" , document.getElementById("minesweeper_box_flagged_blue" ));

	graphics_map.set("hospital_floor_tile" , document.getElementById("hospital_floor_tile" ));
	graphics_map.set("hospital_floor_tile_bad" , document.getElementById("hospital_floor_tile_bad" ));
	graphics_map.set("hospital_doctor1"    , document.getElementById("hospital_doctor1" ));
	graphics_map.set("hospital_doctor2"    , document.getElementById("hospital_doctor2" ));
	graphics_map.set("hospital_doctor3"    , document.getElementById("hospital_doctor3" ));
	graphics_map.set("hospital_doctor4"    , document.getElementById("hospital_doctor4" ));
	graphics_map.set("hospital_patient_in_bed"    , document.getElementById("hospital_patient_in_bed" ));
	graphics_map.set("hospital_patient_in_bed_flipped"    , document.getElementById("hospital_patient_in_bed_flipped" ));
	graphics_map.set("hospital_ui_dirpad"         , document.getElementById("hospital_ui_dirpad" ));
	graphics_map.set("hospital_ui_thumb_buttons"  , document.getElementById("hospital_ui_thumb_buttons" ));

	graphics_map.set("hospital_bed"         , document.getElementById("hospital_bed" ));
	graphics_map.set("hospital_bed_flipped" , document.getElementById("hospital_bed_flipped" ));
	graphics_map.set("hospital_iv_bag"      , document.getElementById("hospital_iv_bag"  ));
	graphics_map.set("hospital_defib"       , document.getElementById("hospital_defib"  ));
	graphics_map.set("hospital_ventilator"  , document.getElementById("hospital_ventilator"  ));
	graphics_map.set("hospital_xray_sheet"  , document.getElementById("hospital_xray_sheet"  ));
	graphics_map.set("hospital_xray_source" , document.getElementById("hospital_xray_source"  ));

	graphics_map.set("hospital_ui_patient_needs_bg"           , document.getElementById("hospital_ui_patient_needs_bg"));
	graphics_map.set("hospital_ui_patient_needs_bg_fixer"     , document.getElementById("hospital_ui_patient_needs_bg_fixer"));
	graphics_map.set("hospital_ui_patient_needs_attention"    , document.getElementById("hospital_ui_patient_needs_attention"));
	graphics_map.set("hospital_ui_patient_needs_low_fluids"   , document.getElementById("hospital_ui_patient_needs_low_fluids"));
	graphics_map.set("hospital_ui_patient_needs_low_oxygen"   , document.getElementById("hospital_ui_patient_needs_low_oxygen"));
	graphics_map.set("hospital_ui_patient_needs_no_heartbeat" , document.getElementById("hospital_ui_patient_needs_no_heartbeat"));
	graphics_map.set("hospital_ui_patient_needs_broken_bone" , document.getElementById("hospital_ui_patient_needs_broken_bone"));
	graphics_map.set("hospital_ui_green_cross" , document.getElementById("hospital_ui_green_cross"));

	graphics_map.set("space_ship1" , document.getElementById("space_ship1"));
	graphics_map.set("lunar_lander" , document.getElementById("lunar_lander"));
	graphics_map.set("swarm_grass_bg1" , document.getElementById("swarm_grass_bg1"));
	graphics_map.set("swarm_broccoli" , document.getElementById("swarm_broccoli"));
	graphics_map.set("swarm_hammer" , document.getElementById("swarm_hammer"));

	graphics_map.set("brick_wall",       document.getElementById("brick_wall"));
	graphics_map.set("spider",           document.getElementById("spider"));




	let popup = document.getElementById("popup");
	let status_err = document.getElementById("status_err");
	let game_options_div = document.getElementById("game_options");

	let g_session_id = null;
	let g_options_visible = false;

	let gfx = new_gfx(canvas, graphics_map, popup, status_msg, status_err, game_options_div);
	gfx.game_options_none_placeholder = document.getElementById("game_options_none_placeholder");
	gfx.game_choice_popup = document.getElementById("game_choice_popup");
	if (URL_args.state) {
		gfx.url_state_b64 = URL_args.state
	}
	const session_id_input       = document.getElementById("session_id_input");
	const custom_ws_server_input = document.getElementById("custom_ws_server_input");

	const board_size = Math.min(canvas.height, canvas.width);


	window.onload = function() {
		console.log("[init] html init");
		set_unset_game_instructions_visible(true);
		html_init = true;
		partial_init();
	}


	canvas.addEventListener('click', handle_canvas_clicked);
	document.getElementById('unset_game_instructions').addEventListener('click', () => {
		console.debug("User clicked 'unset_game_instructions' element. This should be hidden or blocked by the canvas once a game has been initialized.");
		if (gfx.game_id == UNSET_GAME_ID) {
			set_game_choice_popup_visible(true);
		}
	});

	let ws = init_ws(no_ws);

	if (URL_args && URL_args.id) {
		g_session_id = URL_args.id;
		session_id_input.value = g_session_id;
		if (!no_ws) {
			ws_connect_to_session(ws, g_session_id);
		}
	} else {
		if (!no_ws) {
			ws_new_session(ws);
		}
	}

	if (URL_args && URL_args.game) {
		console.log("[init] URL_args: setting gfx.game_id to ", URL_args.game);
		gfx.game_id = URL_args.game;
		console.log("Initializing game ", gfx.game_id);
	} else {
	}

	//set_header_visible(true);
	set_game_title(gfx.game_id);

	let user_colour_pref = get_user_colour_pref();
	if (user_colour_pref) {
		set_html_colour_theme(user_colour_pref);
	}

</script>

<script>
document.getElementById("btn_options").addEventListener('click', function () {
	set_options_popup_visible(true);
});
document.getElementById("btn_status_options").addEventListener('click', function () {
	set_options_popup_visible(true);
});
document.getElementById("btn_close_options").addEventListener('click', function () {
	set_options_popup_visible(false);
});
document.getElementById("btn_game_select").addEventListener('click', function () {
	console.log("[init] btn_game_select clicked: calling game_chosen(UNSET_GAME_ID)");
	game_chosen(UNSET_GAME_ID);
});
document.getElementById("btn_history_browse").addEventListener('click', function () {
	console.log("[init] btn_game_select clicked: calling game_chosen('history_browse')");
	game_chosen("history_browse");
});
document.getElementById("about_link_footer").addEventListener('click', function () {
	set_about_popup_visible(true);
});
document.getElementById("about_link_options").addEventListener('click', function () {
	set_about_popup_visible(true);
});
document.getElementById("btn_close_about_popup").addEventListener('click', function () {
	set_about_popup_visible(false);
});
document.getElementById("input_upload_game_bundle").addEventListener("change", function () {
	document.getElementById("btn_process_uploaded_game_bundle").disabled = false;
});
document.getElementById("btn_process_uploaded_game_bundle").addEventListener('click', function () {

	let fileReader = new FileReader();
	fileReader.onload = function () {
		console.debug("File onload");
		// Write the file to the emscripten file system
		let fname = "/tmp_game_upload.zip";
		let f = new_file(null, fname);
		console.log('[game_upload] fileReader.result =', fileReader.result);
		//console.log(new DataView(fileReader.result));
		//dump_array_buffer(new DataView(fileReader.result));
		write_array_buffer_to_file(null, f, fileReader.result);
		close_file(null, f);
	
		unzip_file(null, fname, "/upload/game1");
		//dump_file(null, fname);

		console.log("[init][game_upload] read uploaded game file, calling game_chosen('upload')");
		// TODO get this "upload" ID from lua_api.h ?
		game_chosen("upload");
	};
	fileReader.onerror = function (e) {
		set_status_err(gfx, "Error reading uploaded game file");
		console.error("Error reading uploaded game file", e);
	};

	let file = document.getElementById("input_upload_game_bundle").files[0];
	console.debug("Reading ", file);
	fileReader.readAsArrayBuffer(file);
});

document.getElementById("btn_submit_multiplayer_settings").addEventListener('click', () => {
	let session_id = session_id_input.value;
	let ws_addr = custom_ws_server_input.value;
	URL_args.ws_server = ws_addr;
	console.log("Updating URL args", session_id, ws_addr);
	update_url_args(null, session_id);
	window.location.reload();
	// TODO trigger refresh
});

document.getElementById("btn_close_game_choice_popup").addEventListener('click', function () {
	set_game_choice_popup_visible(false);
});

function update_colour_pref(colour_pref) {
	set_html_colour_theme(colour_pref);
	update(gfx.ptr);
}

const select_user_colour_pref = document.getElementById("select_user_colour_pref");
select_user_colour_pref.addEventListener("change", function () {
	console.log("[colour_pref] User changed colour preference dropdown");
	let idx = select_user_colour_pref.selectedIndex;
	let value = select_user_colour_pref.options[idx].value;
	set_user_colour_pref(value);
	update_colour_pref(value);
});

set_on_colour_theme_change_handler(update_colour_pref);

document.getElementById("btn_force_refresh").addEventListener('click', function () {
	window.location.reload();
});

console.log("Setting window.onerror");
window.onerror = (message) => {
	console.error("window.onerror called!", message);
	set_status_err(gfx, "window.onerror: " + message);
};

</script>

</body>
</html>
